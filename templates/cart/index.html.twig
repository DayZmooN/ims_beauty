{% extends 'base.html.twig' %}

{% block body %}
<section class="shopping-cart">
    {% if servicesWithForms is not empty %}
        <form action="{{ path('app_cart') }}" method="POST">
            <div class="services-info">
                <h2>Mon Panier</h2>
                <div class="services-list">
                    {% for item in servicesWithForms %}
                        <div class="service-item" data-service-id="{{ item.service.id }}">
                            <div class="service-info">
                                <h3>{{ item.service.name }}</h3>
                                <p>Description: {{ item.service.description }}</p>
                                <p>Prix: {{ item.service.price }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="calendar-options">
                <h2>RÃ©server</h2>
                <div class="slots-list">
                    {% for item in servicesWithForms %}
                        <div class="slot-item" data-service-id="{{ item.service.id }}">
                            {% if googleCalendarSlots is not empty %}
                                <div class="available-slots">
                                    {% for slot in googleCalendarSlots %}
                                        <div class="slot">
                                            <input type="radio" id="google_slot_{{ item.service.id }}_{{ loop.index }}" name="selectedTimeSlot[{{ item.service.id }}]" value="{{ slot }}" required>
                                            <label for="google_slot_{{ item.service.id }}_{{ loop.index }}">{{ slot }}</label>
                                        </div>
                                    {% endfor %}
                                    <a href="{{ path('cart_remove', {'id': item.service.id}) }}" class="btn btn-danger remove-from-cart-link">Retirer</a>
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
            <button type="submit">Confirmer les Rendez-vous</button>
        </form>
    {% else %}
        <p>Votre panier est vide.</p>
    {% endif %}
</section>
{% include './flash_messages/flash_messages.html.twig' %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.remove-from-cart-link').forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            var url = e.currentTarget.href;
            var serviceId = e.currentTarget.closest('tr').dataset.serviceId;

            handleAjaxRequest(url, { method: 'GET' }, function(data) {
                if(data.success) {
                    // Remove the corresponding row from the table
                    var rowToRemove = document.querySelector('tr[data-service-id="' + serviceId + '"]');
                    if (rowToRemove) {
                        rowToRemove.remove();
                    }
                    // Optionally, update other elements like cart total, item count, etc.
                }
            });
        });
    });
});
</script>
{% endblock %}
