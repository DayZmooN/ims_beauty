{% extends 'base.html.twig' %}

{% block title %}Services de la catégorie
	{{ category.name }}
{% endblock %}

{% block body %}
	{% include './components/page-header.html.twig' with {'page_name': page_name, 'breadcrumbs': breadcrumbs} %}
	<section class="category-row">
		<aside class="category-details-aside">
			<div class="services-liste-container">
				<div class="category-title">
					<h1>{{ category.name }}</h1>
				</div>
				<div class="category-services">
					<ul>
						{% for service in services %}
							<li class="service-name" id="service-name-{{ service.id }}" data-service-id="{{ service.id }}">
								{{ service.name }}
							</li>
						{% else %}
							<p>Aucun service à afficher pour cette catégorie.</p>
						{% endfor %}
					</ul>
				</div>
			</div>
			{# Insérer ici aussi la carte de réduction #}
			{% include './components/promotion-box.html.twig' %}
		</aside>

		<section class="service-details">
			{% for service in services %}
				<div id="service-detail-{{ service.id }}" class="service-detail-content">
					<figure
						class="service-thumbnail">
						{# Check if the service has a thumbnail; if not, use the default image #}
						{% if service.thumbnail %}
							<img src="{{ asset('asset/media/banners/' ~ service.thumbnail) }}" alt="{{ service.name }}">
						{% else %}
							<img src="{{ asset('asset/media/banners/' ~ category.thumbnail) }}" alt="">
						{% endif %}
					</figure>
					<div class="service-info">
						<div class="service-name-price">
							<h2>{{ service.name }}</h2>
							<p>{{ service.price }}
								€</p>
						</div>
						<p class="description-service">
							{{ service.description
                            |replace({'<div>': '', '</div>': '', '<br>': 'PLACEHOLDER_BR', '<br/>': 'PLACEHOLDER_BR'})
                            |escape('html')
                            |replace({'PLACEHOLDER_BR': '<br>'})
                            |raw 
                        }}
						</p>
						<p>Durée :
							<span>{{ service.duration }}</span>
						</p>
					</div>
					<div class="animated-btn btn-two">
						<a href="{{path('cart_add', {id: service.id}) }}" class="add-to-cart-link">
							<span>Réservez</span>
							<img src="{{asset('asset/media/icons/deco/lotus.svg')}}" alt="">
						</a>
					</div>
				</div>
			{% else %}
				<p>Ce service n'a pas encore de description rédiger.</p>
			{% endfor %}
			{% include './flash_messages/flash_messages.html.twig' %}
		</section>
		<script>
			document.addEventListener('DOMContentLoaded', function () {
			const datetimePicker = document.querySelector('.datetimepicker');

			if (datetimePicker) {
				datetimePicker.addEventListener('change', function () {
				const selectedDate = new Date(this.value);
				const hoursSelect = this.querySelector('select[id$=_hour]'); // Modifier l'ID selon votre structure HTML

				if (hoursSelect) {
					adjustTimeOptions(hoursSelect, selectedDate);
				}
				});
			}

			function adjustTimeOptions(hoursSelect, selectedDate) {
			const hours = Array.from(hoursSelect.options).map(option => parseInt(option.value));

			hours.forEach(hour => {
			const option = hoursSelect.querySelector (`option[value="${hour}"]`);
			if (hour < 8 || hour > 17 || (hour >= 12 && hour < 13.5)) {
			option.disabled = true;
			} else {
			option.disabled = false;
			}
			});
			}
			});

			//flash messages
document.querySelectorAll('.add-to-cart-link').forEach(function(link) {
		link.addEventListener('click', function(e) {
			e.preventDefault();
			handleAjaxRequest(e.currentTarget.href, { method: 'GET' }, function(data) {
				if (data.success) {
					updateCartItemCount(1); // Increment cart count
				}
			});
		});
	});

		</script>
	{% endblock %}
